# 层次结构

**摘要：**

我所服务的单位是国内领先的大型金融机构之一。作为该机构的核心技术人员，我在 2021 年 1 月主导了一项关于贷款处理系统的开发项目。该系统是我们机构综合业务系统的重要组成部分。鉴于银行系统对安全性、可靠性、可用性和响应速度的高要求，我选择了三层C/S结构作为该系统的软件体系结构。在详细设计三层结构的过程中，我采用了字符终端作为表示层，CICS TRANSACTION SERVER作为中间层，以及DB2 UDB7.1作为数据库层。为解决设计过程中遇到的问题，我采用了CICS SWITCH组和并行批量处理的方法，确保了贷款处理系统能按计划完成并顺利投入运营。我设计的软件三层结构得到了同事和领导的一致认可和赞赏。然而，我也意识到在三层结构设计中存在一些不足之处：例如，中间层的负载均衡算法过于简单，容易导致系统负荷不均衡，以及并行批量设计不够严谨，容易造成资源冲突等。通过这个项目，我不仅积累了宝贵的实践经验，也为未来的系统优化和改进提供了有益的参考。

**正文：**

在设计贷款处理系统的过程中，技术层面的考量是至关重要的。我所在的单位是国内领先的大型金融机构，为了更好地服务大客户并适应市场的快速发展，我们在2021年1月启动了贷款处理系统的开发项目。该系统是我们综合业务系统的重要组成部分，主要包括联机处理、批量处理、清算和通兑等模块，具备协议管理、合约管理、报价管理、贷款敞口管理、账务管理、数据拆分管理、报表管理、业务缩微和事后监督等功能。作为单位的主要技术骨干之一，我主持并参与了该系统的项目计划、需求分析、设计、编码和测试阶段的工作。

由于金融机构系统对安全性，可靠性，可用性和响应速度要求很高，我选择了三层 C/S 结构作为该系统的软件体系结构，下面，我将分层次详细介绍三层 C/S 软件体系结构的设计过程。

1. **表示层设计**：考虑到银行系统对安全性、可靠性、可用性和响应速度的高要求，我们选择了三层C/S结构作为该系统的软件体系结构。在表示层，我们曾考虑使用IBM的VISUALGEN 2.0附带的图形用户终端开发终端程序，但由于响应速度不佳，特别是在业务量较大时，我们决定自行开发一套字符终端CITE，采用VISUAL BASIC作为开发语言，以确保快速的响应和强大的交互能力。
2. **中间层设计**：中间层我们选择了CICS TRANSACTION SERVER(CTS)作为解决方案。由于与IBM公司保持良好的合作关系，且大部分技术和设备都采用了IBM的产品，我们决定继续采用CTS作为中间层，以保证与原有系统的兼容和互用性。此外，我们采用VISUALAGE FOR JAVA作为业务逻辑的开发平台，它的简单易用特点非常适合业务逻辑的开发，能够帮助开发人员快速而准确地完成业务逻辑的开发，确保了项目的顺利完成。
3. **数据层设计**：在数据层，我们选择了DB2 UDB7.1作为数据库解决方案。DB2在大型事务处理系统中的表现出色，我们的团队在DB2数据库的使用方面积累了丰富的经验和技术人才。选择DB2 UDB7.1不仅延续了技术的连续性，也保护了原有的投资。

通过这三层C/S软件体系结构的设计，我们成功构建了一个高效、可扩展和可维护的贷款处理系统，为我所在的金融机构提供了强有力的业务支持，同时也为我个人在系统架构设计方面带来了宝贵的经验和深刻的认识。

在贷款处理系统的设计过程中，我也遭遇了一些挑战，但通过以下策略成功地解决了这些问题：

1. **高可用性中间层设计**：鉴于银行系统对安全性、可靠性、可用性和响应速度的严格要求，尤其在我行最近实施了数据集中，仅在XX和Y两地设立数据中心后，这些要求变得更为严格。为确保系统的高度可用性，我采用了CTS SWITCH组技术。简单来说，CICS SWITCH组是一组具有相同业务逻辑的CTS，共同作为中间层，从而消除了单点故障的风险。为简化系统设计并缩短通信时间，我采用了简单的负载均衡算法，例如，本次请求分配给第N个CTS，下次请求则分配给第N+1个CTS，以此类推，当轮询至最后一个CTS后，再从第一个CTS开始。为进一步提高系统的容错能力，当第N个CTS失效时，我设计了将其正在处理的业务转移到下一个CTS继续处理的机制，这大大提高了系统的可用性。此外，通过应用数据库连接池技术，我成功地缩短了数据库处理时间，提高了系统运行速度。
2. **并行批处理技术**：由于银行系统每天需要处理大量数据，为确保日间业务的顺利进行，某些账务处理任务，如部分内部账户处理、代理收费业务和总账与分户账核对等，需在夜间批量处理。但数据集中后，数据量显著增大，传统的串行提交批处理作业方式已无法满足亿万级数据处理的需求。经过与技术团队的讨论、充分的论证和测试，我决定采用并行批处理技术。利用IBM的PC (Tivoli Operations, Planning and     Control)技术，我们在操作员统一提交批处理作业的基础上，进一步利用DB2的PARTITION技术，将不同地区的数据分配到不同的PARTITION中独立处理，显著提高了数据处理速度，确保了贷款处理系统三层结构的先进性。在设计并行批处理过程中，我考虑到批处理作业可能因网络错误或资源冲突而中断，因此在编写批处理程序和作业时，特别设计了支持断点重提的功能，以确保生产的顺利进行。

通过这些技术策略和解决方案，我成功地解决了设计过程中遇到的困难，为贷款处理系统的高效、可扩展和可维护性提供了有力保障。

由于我对贷款处理系统的三层结构设计精心策划，并采取了有效的措施解决了设计过程中遇到的问题，该系统最终按计划完成并顺利投入运营。不仅确保了系统的开放性、可用性和互用性，还取得了良好的社会效益和经济效益。我的三层结构设计得到了同事和领导的一致认可与赞赏，为我行未来系统的开发奠定了坚实的基础。

 

在反思经验的同时，我也意识到了在贷款处理系统的三层结构设计中的一些不足之处：首先，负载分配算法过于简单，容易导致系统负荷不均衡。由于每个业务处理时间的不同，有的可能差异较大，简单的顺序加一负载分配算法容易造成负载不均衡。但是，如果专门设置一个分配器，会增加一次网络通讯，从而降低系统的速度，这对于对响应速度要求极高的银行系统来说是不可接受的。因此，我决定采用基于统计的分配算法，即在收到请求时，根据预设的权值，按概率直接分配给CTS。其次，由于批量作业顺序设计不够严谨等原因，容易造成资源冲突。在贷款处理系统运行了一段时间后，数据中心的维护人员发现系统时不时会出现资源冲突现象。经过仔细分析，我发现，由于每天各个业务的业务量大小不一样，顺序的两个作业之间访问同一个表时便会产生资源冲突。另外，在OPC作业运行的过程中，操作员提交的其他作业与此时间的OPC作业也有可能产生资源冲突。对于第一种情况，可以在不影响业务的前提下调整作业顺序，或者对于查询作业运用DB2的共享锁技术。而对于第二种情况，则需要制定规范，规定在某时间段内不允许提交某些作业以解决冲突问题。为了更好地进行系统分析和优化，我计划在未来的工作实践中不断学习和提升自身的专业素质和能力，为我国的软件事业贡献自己的力量。
